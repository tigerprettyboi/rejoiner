--// ========================== CONFIG ==========================
local REJOIN_INTERVAL_SECONDS = 130         -- เวลานับถอยหลังก่อนรีจอย (หน่วย: วินาที)
local PLACE_ID_TO_REJOIN = 103754275310547  -- PlaceId ที่จะวาร์ปไป
local ERROR_RETRY_SLEEP_TIME = 3             -- หน่วงเวลาก่อนรีลองใหม่เมื่อ Teleport fail
--// ============================================================


-- โหลด Services
local PlayersService = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = PlayersService.LocalPlayer

-- สร้าง GUI หลัก
local Screen = Instance.new("ScreenGui")
Screen.Name = "RejoinUI_" .. tostring(math.random(10000,99999))
Screen.ResetOnSpawn = false
Screen.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
Screen.Parent = LocalPlayer:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 0x118, 0, 0x78)
MainFrame.Position = UDim2.new(1, -0x12C, 0, 0x14)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = Screen

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 12)
Corner.Parent = MainFrame

local Gradient = Instance.new("UIGradient")
Gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 35, 45)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 25))
}
Gradient.Rotation = 45
Gradient.Parent = MainFrame

local Stroke = Instance.new("UIStroke")
Stroke.Color = Color3.fromRGB(60, 60, 70)
Stroke.Thickness = 1
Stroke.Transparency = 0.5
Stroke.Parent = MainFrame

local Icon = Instance.new("ImageLabel")
Icon.Size = UDim2.new(0, 24, 0, 24)
Icon.Position = UDim2.new(0, 15, 0, 15)
Icon.BackgroundTransparency = 1
Icon.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
Icon.ImageColor3 = Color3.fromRGB(100, 200, 255)
Icon.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -50, 0, 25)
Title.Position = UDim2.new(0, 45, 0, 15)
Title.BackgroundTransparency = 1
Title.Text = "Auto Rejoin"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = MainFrame

local Status = Instance.new("TextLabel")
Status.Size = UDim2.new(1, -20, 0, 18)
Status.Position = UDim2.new(0, 10, 0, 42)
Status.BackgroundTransparency = 1
Status.Text = "Next rejoin in:"
Status.Font = Enum.Font.Gotham
Status.TextSize = 12
Status.TextColor3 = Color3.fromRGB(200, 200, 200)
Status.TextXAlignment = Enum.TextXAlignment.Center
Status.Parent = MainFrame

local TimerLabel = Instance.new("TextLabel")
TimerLabel.Size = UDim2.new(1, -20, 0, 35)
TimerLabel.Position = UDim2.new(0, 10, 0, 60)
TimerLabel.BackgroundTransparency = 1
TimerLabel.Text = "02:00"
TimerLabel.Font = Enum.Font.GothamBlack
TimerLabel.TextSize = 28
TimerLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
TimerLabel.TextXAlignment = Enum.TextXAlignment.Center
TimerLabel.Parent = MainFrame

local ProgressBG = Instance.new("Frame")
ProgressBG.Size = UDim2.new(1, -20, 0, 3)
ProgressBG.Position = UDim2.new(0, 10, 1, -15)
ProgressBG.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
ProgressBG.BorderSizePixel = 0
ProgressBG.Parent = MainFrame

local PBGcorner = Instance.new("UICorner")
PBGcorner.CornerRadius = UDim.new(0, 2)
PBGcorner.Parent = ProgressBG

local ProgressFill = Instance.new("Frame")
ProgressFill.Size = UDim2.new(1, 0, 1, 0)
ProgressFill.Position = UDim2.new(0, 0, 0, 0)
ProgressFill.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
ProgressFill.BorderSizePixel = 0
ProgressFill.Parent = ProgressBG

local PFillCorner = Instance.new("UICorner")
PFillCorner.CornerRadius = UDim.new(0, 2)
PFillCorner.Parent = ProgressFill

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 20, 0, 20)
CloseButton.Position = UDim2.new(1, -25, 0, 5)
CloseButton.BackgroundTransparency = 1
CloseButton.Text = "×"
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 16
CloseButton.TextColor3 = Color3.fromRGB(200, 200, 200)
CloseButton.Parent = MainFrame


-- ฟังก์ชันเสริม
local function Tween(obj, info, props)
    return TweenService:Create(obj, info, props)
end

local function formatTime(sec)
    local m = math.floor(sec / 60)
    local s = sec % 60
    return string.format("%02d:%02d", m, s)
end

local function updateProgress(current, total)
    Tween(ProgressFill, TweenInfo.new(0.2, Enum.EasingStyle.Quad),
        {Size = UDim2.new(current/total, 0, 1, 0)}):Play()
end

local function updateColor(remaining, total)
    local ratio = remaining/total
    local col = Color3.fromRGB(100,200,255)
    if ratio <= 0.25 then col = Color3.fromRGB(255,100,100)
    elseif ratio <= 0.5 then col = Color3.fromRGB(255,200,100) end
    Tween(TimerLabel, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {TextColor3 = col}):Play()
end

local function setStatus(txt, col)
    Status.Text = txt
    Status.TextColor3 = col or Color3.fromRGB(200, 200, 200)
end

local function attemptTeleport()
    setStatus("Teleporting...", Color3.fromRGB(100, 255, 100))
    TimerLabel.Text = "00:00"

    local ok, err = pcall(function()
        TeleportService:Teleport(PLACE_ID_TO_REJOIN, LocalPlayer)
    end)
    if not ok then
        warn("Teleport failed:", err)
        setStatus("Teleport failed! Retrying...", Color3.fromRGB(255, 100, 100))
        TimerLabel.Text = "ERROR"
        TimerLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        task.wait(ERROR_RETRY_SLEEP_TIME)
        return false
    end
    return true
end


-- ปุ่มปิด GUI
CloseButton.Activated:Connect(function()
    Tween(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In),
        {Position = UDim2.new(1, -100, 0, 20), BackgroundTransparency = 1}):Play()
    task.wait(0.3)
    Screen:Destroy()
end)


-- ลูปนับเวลา + รีจอย
task.spawn(function()
    while Screen.Parent do
        local t = REJOIN_INTERVAL_SECONDS
        setStatus("Next rejoin in:")

        while t > 0 and Screen.Parent do
            TimerLabel.Text = formatTime(t)
            updateProgress(REJOIN_INTERVAL_SECONDS - t, REJOIN_INTERVAL_SECONDS)
            updateColor(t, REJOIN_INTERVAL_SECONDS)
            task.wait(1)
            t -= 1
        end

        if Screen.Parent then
            if not attemptTeleport() then
                updateProgress(0, REJOIN_INTERVAL_SECONDS)
            else
                break
            end
        end
    end
end)
